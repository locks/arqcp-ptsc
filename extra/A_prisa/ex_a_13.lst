
IGNITE Macro Assembler 1.8         ex_a_13.s        10/26/08 18:43  Page    1

   1 T                          ; Enunciado:
   2 T                          ;
   3 T                          ; A13:	Faça uma rotina que faça a conversão Ce
                                lsius/Fahrenheit.
   4 T                          ;	Na pilha, os parâmetros de entrada e de
                                 saída são os apresentados na indicação feita p
                                ara referência à rotina.
   5 T                          ;	celsiusFahrenheit(n1 -- n2)
   6 T                          ;
   7 T                          ;	A regra de conversão será:
   8 T                          ;		C = 5/9*(F-32)
   9 T                          ;
  10 T                          
  11 T                          .file "ex_a_13.s"
  12 T                          .include  "auxil.s"      
       STARTING INPUT FROM FILE: .\auxil.s
   1 T                          
   2 T                                  .file "auxil.s"   ; Ficheiro com defini
                                ‡Æo de pseudo-instru‡äes
   3 T                                                    ;  apenas "entendidas
                                " pelo emulador
   4 T                                                    ;
   5 T                                                    ; Estas instru‡äes nÆ
                                o existem no processador
   6 T                                                    ; real mas sƒo £teis 
                                no emulador.
   7 T                                                    ;
   8 T                                                    ; Usar apenas as docu
                                mentadas.
   9 T                                                    ;
  10 T                                                    ;
  11 T                                                    ; Para as usar num pr
                                ograma devemos ter a linha
  12 T                                                    ;      .include "auxi
                                l.s"
  13 T                                                    ; nesse programa, ant
                                es de as usar
  14 T                          
  15 T                                  .opt fill=0xea    ; dizer ao assemlbler
                                 para encher "os buracos"
  16 T                                                    ; com o opcode do nop
  17 T                          
  18                                    .macro prof
  19                                    .opcode 0xf8
  20                                    .endm
  21 T                          
  22                                    .macro setarg
  23                                    .opcode 0xf9
  24                                    .endm
  25 T                          
  26                                    .macro setrom
  27                                    .opcode 0xfa
  28                                    .endm
  29 T                          
  30                                    .macro keyq        ; ( -- flag )
  31                                    .opcode 0xfb       ;  Devolve 0 (zero) 
                                se nao houver nenhuma tecla
  32                                    .endm              ;  para ser lida ou 
                                -1 se existirem teclas para
  33 T                                                     ;  serem lidas

IGNITE Macro Assembler 1.8         ex_a_13.s        10/26/08 18:43  Page    2

       SECTION: .text 
  34 T                                                     ;  keyq == key? == k
                                ey question
  35 T                          
  36                                    .macro key         ;   ( -- b )
  37                                    .opcode 0xfc       ;   Lˆ uma tecla da 
                                janela de terminal e deixa
  38                                    .endm              ;   na stack obyte c
                                orrespondente
  39 T                                                     ;   ao respectivo c¢
                                digo ASCII
  40 T                          
  41 T                          
  42 T                          
  43                                    .macro emit        ;  ( b -- )
  44                                    .opcode 0xfd       ;  Imprime na janela
                                 de terminal o caracter cujo c¢digo
  45                                    .endm              ;  ASCII se encontra
                                 no topo da stack
  46 T                          
  47 T                          
  48                                    .macro halt        ;  P ra o Emulador
  49                                    .opcode 0xfe       ;
  50                                    .endm              ;
  51 T                          
       ENDING   INPUT FROM FILE: .\auxil.s
       RESUMING INPUT FROM FILE: ex_a_13.s
  13 T                          .include "mylib.s"			
                                		; definições auxiliares
       STARTING INPUT FROM FILE: .\mylib.s
   1 T                          .file "mylib.s"
   2 T                          
   3 T 00000000                 mymulu::
   4 T 00000000  70             	push g0
   5 T 00000001     ba          	pop lstack
   6 T 00000002        50       	pop g0
   7 T 00000003           20    	push.n #0
   8 T 00000004  d7             	mulu
   9 T 00000005     b3          	pop
  10 T 00000006        9a       	push lstack
  11 T 00000007           50    	pop g0
  12 T                          	
  13 T 00000008  6e             	ret
     T 00000009     30 30 30 
  14 T 0000000c                 mymuls::
  15 T 0000000c  70             	push g0
  16 T 0000000d     ba          	pop lstack
  17 T 0000000e        50       	pop g0
  18 T 0000000f           20    	push.n #0
  19 T 00000010  d7             	mulu
  20 T 00000011     b3          	pop
  21 T 00000012        9a       	push lstack
  22 T 00000013           50    	pop g0
  23 T                          	
  24 T 00000014  6e             	ret
  25 T                          
     T 00000015     30 30 30 
  26 T 00000018                 mydivu::

IGNITE Macro Assembler 1.8         ex_a_13.s        10/26/08 18:43  Page    3

       SECTION: .text 
  27 T 00000018  70             	push g0
  28 T 00000019     ba          	pop lstack
  29 T 0000001a        50       	pop g0
  30 T 0000001b           20    	push.n #0
  31 T 0000001c  de             	divu
  32 T 0000001d     9a          	push lstack
  33 T 0000001e        50       	pop g0
  34 T                          	
  35 T 0000001f           6e    	ret
  36 T                          
  37 T 00000020                 .end
       ENDING   INPUT FROM FILE: .\mylib.s
       RESUMING INPUT FROM FILE: ex_a_13.s
  14 A                          .org 0x1000        			; progr
                                ama inicia-se no byte 0x1000
       SECTION: ORG SECTION (ORG 00001000)
  15 A 00001000  00 00 00 06    	br inicio
  16 A                          
  17 A                          
  18 A 00001004                 celsiusFahrenheit::			;  (n1 
                                -- n2)
  19 A 00001004  c8             	sub
  20 A 00001005     e4          	rev
  21 A 00001006        30 30    	call mymuls
     A 00001008  0f'ff'f0'04'
  22 A 0000100c  b2             	xcg
  23 A 0000100d     30 30 30    	call mydivu
     A 00001010  0f'ff'f0'08'
  24 A 00001014  6e             	ret
  25 A                          
  26 A                          
     A 00001015     30 30 30 
  27 A 00001018                 inicio::
  28 A 00001018  25             	push.n #5
  29 A 00001019     90          	push.b #9
  30 A 0000101a        4f 09    	push.l #50
     A 0000101c  00 00 00 32 
  31 A 00001020  4f             	push.l #32
  32 A                          
  33 A 00001021     0f ff f9    	call celsiusFahrenheit
     A 00001024  00 00 00 20 
  34 A                          
  35 A                          	halt
  36 A 00001029                 	.end

Total Errors:      0
Total Warnings:    0


SYMBOL TABLE

Value     Section/Type  Name

00000018  .text         mydivu
0000000c  .text         mymuls
00000000  .text         mymulu

00003e80  ABSOLUTE      __CLOCK_KHZ__
00000001  ABSOLUTE      __IGNITE_2F__
00000065  ABSOLUTE      __PATRIOTC__
00000064  ABSOLUTE      __SEP__
00001004  ABSOLUTE      celsiusFahrenheit
00001018  ABSOLUTE      inicio
